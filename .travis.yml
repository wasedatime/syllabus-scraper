language: python
python:
  - "3.8"

# command to install dependencies
install:
  - virtualenv myvenv
  - source myvenv/bin/activate
  - pip install -r requirements.txt
  - deactivate
  - cd myvenv/lib/python3.8/site-packages
  - zip -r9 ${OLDPWD}/function.zip .
  - cd $OLDPWD
  - zip -g function.zip syllabus_scraper.py
  - zip -g function.zip scraper
script:
  - python tests/test.py
deploy:
  provider: lambda
  function_name: "scrape-syllabus"
  region: "ap-northeast-1"
  handler_name: "handler"
  runtime: "python3.8"
  role: "arn:aws:iam::564383102056:role/AWSLambdaS3FullAccess"
  zip: "fileb://function.zip"
  on:
    all_branches: true
  edge: true